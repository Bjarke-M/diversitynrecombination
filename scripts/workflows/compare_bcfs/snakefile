# Import the os module for working with file paths and directories
import os

#species names in the analysis
species_names = ['Daubentonia_madagascariensis','Saguinus_midas','Chlorocebus_aethiops',
                 'Rhinopithecus_roxellana','Mandrillus_sphinx','Macaca_mulatta','Loris_tardigradus','Callithrix_jacchus',
                 'Pithecia_pithecia','Lemur_catta-Thomas','Gorilla_gorilla_gorilla','Aotus_nancymaae','Sapajus_apella',
                 'Pongo_abelii','Cercocebus_atys','Galago_moholi','Nomascus_leucogenys','Colobus_guereza',
                 'Cebus_albifrons','Cercopithecus_mitis','Pongo_pygmaeus','Pan_troglodytes','Erythrocebus_patas',
                 'Microcebus_murinus','Atele_fusciceps','Otolemur_garnettii','Nycticebus_pygmaeus']
#Missing g.vcf.gz species: Theropithecus_gelada
#Missing chainfiles: Carlito_syrichta Propithecus_coquereli'


/home/bjarkemp/primatediversity/data/het_data_11_04_2022/lifted_GtVar/Daubentonia_madagascariensis_lifted.vcf.unmap.gz
/home/bjarkemp/primatediversity/data/het_data_11_04_2022/lifted_GtVar/Daubentonia_madagascariensis_lifted.vcf.gz

/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/liftover/Daubentonia_madagascariensis/vcfs/Daubentonia_madagascariensis_lifted.vcf
/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/liftover/Daubentonia_madagascariensis/vcfs/Daubentonia_madagascariensis_lifted.vcf.unmap

#rule for looping over species names and creating a list of samples
rule all:
    input:
        expand([
            "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_erik.0000.vcf",
            "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_me.0001.vcf",
            "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.intersect.0002.vcf",
            "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_erik_unmap.0000.vcf",
            "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_me_unmap.0001.vcf",
            "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.intersect_unmap.0002.vcf"
        ], species=species_names)
 
#comment: 
# -n=2: Output positions present in exactly 2 files (A and B).
# -c all: Output both shared and different sites.
# A.vcf.gz B.vcf.gz: Input VCF files to compare.
# -o shared_and_different_sites: Output directory where the results will be stored.

rule compare_all_mapped:
    input:
        vcf_erik = "/home/bjarkemp/primatediversity/data/het_data_11_04_2022/lifted_GtVar/{species}_lifted.vcf.gz",
        vcf_me = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/liftover/{species}/vcfs/{species}_lifted.vcf"
    output:
        unique_erik = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_erik.0000.vcf"
        unique_me = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_me.0001.vcf"
        intersect = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.intersect.0002.vcf"
    shell:
        """
        bcftools isec -n=2 -c all {input.vcf_me} {input.vcf_erik} -p /home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}/
        """

rule compare_all_unmapped:
    input:
        vcf_erik = "/home/bjarkemp/primatediversity/data/het_data_11_04_2022/lifted_GtVar/{species}_lifted.vcf.unmap.gz",
        vcf_me = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/liftover/{species}/vcfs/{species}_lifted.vcf.unmap"
    output:
        unique_erik = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_erik_unmap.0000.vcf"
        unique_me = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_me_unmap.0001.vcf"
        intersect = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.intersect_unmap.0002.vcf"
    shell:
        """
        bcftools isec -n=2 -c all {input.vcf_me} {input.vcf_erik} -o {output.txt}
        """

rule count_all_2_csv:
    input:
        unique_erik = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_erik.0000.vcf",
        unique_me = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_me.0001.vcf",
        intersect = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.intersect.0002.vcf",
        unique_erik_unmap = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_erik_unmap.0000.vcf",
        unique_me_unmap = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.unique_me_unmap.0001.vcf",
        intersect_unmap = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.intersect_unmap.0002.vcf"
    output:
        csv = "/home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/data/vcf_check/{species}.csv"
    shell:
        """
        python3 /home/bjarkemp/primatediversity/people/bjarkemp/diversitynrecombination/scripts/count_all_2_csv.py {input.unique_erik} {input.unique_me} {input.intersect} {input.unique_erik_unmap} {input.unique_me_unmap} {input.intersect_unmap} {output.csv}
        """

rule combine_csvs:
# make done when you know the output from above
